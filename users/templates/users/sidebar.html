{% load static %}
{% load humanize %}
<style>
    .sidenav {
      height: 100%;
      width: 0;
      position: fixed;
      z-index: 1200;
      bottom: 0;
      right: 0;
      background-color: #fff;
      overflow-x: hidden;
      transition: .5s;
    }

    .sidenav a {
      text-decoration: none;
      color: #000;
      display: block;
      transition: 0.3s;
    }

    .sidenav .closebtn {
      position: absolute;
      top: 0;
      right: 25px;
      font-size: 36px;
      margin-left: 50px;
    }

    @media screen and (max-height: 450px) {
      .sidenav {padding-top: 15px;}
    }
    .notifications-bg{
        background-color: #fff;
        height: 70px;
    }

</style>


<div id="mySidenav" class="sidenav shadow">
    <div class=" sidenav-content">
        <!--    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>-->
        <div class="row sticky-top notifications-bg mt-3 p-3">
            <div class="col">
                <a class="tablinks" onclick="openCity(event, 'Notifications')" style="cursor:pointer">
                    <h5 class="mb-2"><b>Notifications</b></h5></a>
            </div>
            <div class="col">
                <a class="tablinks" onclick="openCity(event, 'Cart')" style="cursor:pointer"
                   id="defaultOpen">
                    <h5 class="mb-2"><b>Cart ({{get_cart_items}})</b></h5></a>
            </div>
            <div style="cursor:pointer" class="col-auto d-flex mr-2">
                <a data-toggle="tooltip" class="tooltip-test read-btn"
                   data-href="{% url 'update_notification' %}" data-placement="top" title="Mark as read">
                    <svg onclick="readBtn()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         class="read-btn mr-3 mt-1 text-secondary" height="20" width="20">
                        <g>
                            <path d="M23.22,2.06a1.49,1.49,0,0,0-2,.59l-8.5,15.43L6.46,11.29a1.5,1.5,0,1,0-2.21,2l7.64,8.34a1.52,1.52,0,0,0,2.42-.29L23.81,4.1A1.5,1.5,0,0,0,23.22,2.06Z"
                                  style="fill: currentColor"></path>
                            <path d="M2.61,14.63a1.5,1.5,0,0,0-2.22,2l4.59,5a1.52,1.52,0,0,0,2.11.09,1.49,1.49,0,0,0,.1-2.12Z"
                                  style="fill: currentColor"></path>
                            <path d="M10.3,13a1.41,1.41,0,0,0,2-.54L16.89,4.1a1.5,1.5,0,1,0-2.62-1.45L9.68,11A1.41,1.41,0,0,0,10.3,13Z"
                                  style="fill: currentColor"></path>
                        </g>
                    </svg>
                </a>
                <h5 class="btn-close-sidebar" onclick="closeNav()"><b>X</b></h5>
            </div>
        </div>
        <hr class="my-1 mb-2">
        <div id="Cart" style="overflow-wrap: break-word;" class="tabcontent">
            <div class="container p-3">
                {% if check_out_list %}
                {% for item in check_out_list %}
                <div class="row">
                    <div class="col">
                        <div class="media">
                            {% for product_image in item.product.productimage_set.all %}
                            {% if forloop.first %}
                            <img height="70px" width="70px" src="{{ product_image.image.url }}" alt=""
                                 class="row-ima">
                            {% endif %}

                            {% endfor %}
                            <div class="media-body ml-2" style="overflow-wrap: break-word;">
                                <strong style="overflow-wrap: break-word;overflow-wrap: break-word;">
                                    {{ item.product.name }}
                                    <br>
                                    ₦{{ item.product.price|floatformat:'2'|intcomma }}
                                </strong>
                            </div>
                        </div>
                    </div>
                    <div class="col-auto"><small>Qty: {{ item.quantity }}</small></div>
                </div>
                <hr>
                {% endfor %}
                {% else %}
                <h5 class="align-items-center justify-content-center">
                    Nothing to see here because no cart item(s).
                </h5>
                {% endif %}
            </div>
            <div class="sidebar-cart-footer">
                    <hr>
                    <div class="w-100">
                        <h5 class="mb-4">
                            <b>Subtotal: <span class="float-right">
                                ₦{{ get_cart_total|floatformat:2|intcomma }}</span>
                            </b>
                        </h5>
                        <div class="d-grid gap-3">
                            <a class="btn btn-dark" style="letter-spacing: 0.2em;
                                text-transform: uppercase;" href="{% url 'checkout' %}">
                                View cart & Checkout
                            </a>
                        </div>
                    </div>
                </div>
        </div>
        <section id="Notifications" class="tabcontent container">
            {% if notification|length >= 1 %}
            {% for follow_notification in notification %}
            {% if follow_notification.notification_type == 1 %}
            <a class="dropdown-item d-flex align-items-center" href="#">
                <div class="dropdown-list-image mr-2">
                    <img src="{% static 'images/user.png' %}"
                         class="avatar rounded-circle" width="40px" height="40px"
                         alt="...">
                </div>
                <div>
                    <div class="small text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                             fill="currentColor" class="bi bi-clock" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                        </svg>
                        {{ follow_notification.date_posted }}
                    </div>
                    <span class="font-weight-bold">
                made an order!
            </span>
                </div>
            </a>
            <hr class="my-3">
            {% endif %}
            {% if follow_notification.notification_type == 2 %}
            <a class="dropdown-item d-flex align-items-center" href="#">
                <div class="dropdown-list-image mr-2">
                    <img src="{% static 'images/user.png' %}"
                         class="avatar rounded-circle" width="40px" height="40px"
                         alt="...">
                </div>
                <div>
                    <div class="small text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                             fill="currentColor" class="bi bi-clock" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                        </svg>
                        {{ follow_notification.date_posted }}
                    </div>
                    <span class="font-weight-bold">

                Account created for you!
            </span>
                </div>
            </a>
            <hr class="my-3">
            {% endif %}
            {% endfor %}

            {% else %}
            <br>
            <br>
            <br>
            <div class="container align-items-center justify-content-center">
                <div class="container align-items-center justify-content-center"
                     style="border-radius:50%; width: 4rem; height: 4rem; background-color: lightgrey">
                    <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" fill="currentColor"
                         class="bi mt-3 ml-2 align-items-center justify-content-center bi-bell-slash"
                         viewBox="0 0 16 16">
                        <path d="M5.164 14H15c-.299-.199-.557-.553-.78-1-.9-1.8-1.22-5.12-1.22-6 0-.264-.02-.523-.06-.776l-.938.938c.02.708.157 2.154.457 3.58.161.767.377 1.566.663 2.258H6.164l-1 1zm5.581-9.91a3.986 3.986 0 0 0-1.948-1.01L8 2.917l-.797.161A4.002 4.002 0 0 0 4 7c0 .628-.134 2.197-.459 3.742-.05.238-.105.479-.166.718l-1.653 1.653c.02-.037.04-.074.059-.113C2.679 11.2 3 7.88 3 7c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0c.942.19 1.788.645 2.457 1.284l-.707.707zM10 15a2 2 0 1 1-4 0h4zm-9.375.625a.53.53 0 0 0 .75.75l14.75-14.75a.53.53 0 0 0-.75-.75L.625 15.625z"/>
                    </svg>
                </div>
                <h5 class="align-items-center justify-content-center">
                    Nothing to see here because no notifications yet.
                </h5>
            </div>
            <br>
            <br>
            <hr>

            {% endif %}
        </section>
    </div>
</div>
<style>
    .sidebar-cart-footer {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 190px;
        padding-right: 2rem;
        padding-left: 2rem;
        border: none;
        z-index: 10005;
        justify-content: flex-start;
        align-content: center;
    }
</style>
<!--<span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776; open</span>-->

<script>

    function openNav() {
      var x = document.getElementById("mySidenav");
      x.style.width = "390px";
      //document.querySelector(".screen-overlay.show").style.backgroundColor = "red";
     // document.getElementById("counter").innerHTML= "0";
    }
    //function closeNav() {
      //  var x = document.getElementById("mySidenav");
        //x.style.width = "0";
    //}
    $(document).ready(function() {
        $(".btn-close-sidebar, .screen-overlay").click(function(e){
            $(".screen-overlay").removeClass("show");
            $("#mySidenav").css("width", "0");
            $(".screen-overlay").removeClass("show");

        });

        // Close menu when pressing ESC
        $(document).on('keydown', function(event) {
            if(event.keyCode === 27) {
               $("#mySidenav").css("width", "0");
            }
        });


    });

    function readBtn(){
        document.getElementById("counter").innerHTML= "0";
    }
    $(document).ready(function(){
      $(".read-btn").click(function(e){
        e.preventDefault()
        var this_ = $(this)
        var notificationUrl = this_.attr("data-href")
        if (notificationUrl){
           $.ajax({
            url: notificationUrl,
            method: "GET",
            data: {},
            success: function(data){
              console.log(data)
              var newNotification;
              if (data.updated){
                    $('.toast').toast('show');
                    $("#json_messages").text(data.messages);
                  //$("#counter").hide();
                  //$(".noti_count").text("09");
                 }
                }, error: function(error){
                  console.log("error")
            }
          })
        }

      })
    })
</script>
<script>
    function openCity(evt, cityName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(cityName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    // Get the element with id="defaultOpen" and click on it
    document.getElementById("defaultOpen").click();


</script>
